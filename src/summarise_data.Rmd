---
title: "Summary of physchological questionnaire answers"
author: "Abigail Edwards and Mikko Arvas"
date: "`r Sys.time()`"
output:
  html_document:
    toc: true
    theme: united
---





```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
library(tidyverse)
library(gtsummary)
library(likert)
library(readxl)
library(here)
#https://github.com/markolalovic/responsesR
#install.packages("devtools")
#library(devtools)
# install_github("markolalovic/responsesR")
#library(responsesR)
```


# Data

## Import

```{r}
# file <- here("data/Tulokset - xxxxx.xlsx")
# data <- read_xlsx(file,n_max = XX)
# summary(data)
```

Items
<table>
<tr>
<td></td>
<td> Psychological ownership</td>
</tr>
<tr>
<td>po01</td>
<td>
1. I feel a very high degree of personal ownership of donating blood.
</td>
</tr>
<tr>
<td>po02</td>
<td>
2. I feel like donating blood belongs to me.
</td> </tr>
<tr>
<td>po03</td> <td>
3. I feel like I own donating blood.
</td> </tr>
<tr> <td></td>
<td>
Self-identity
</td> </tr>
<tr>
<td>si01</td>
<td>
1. Donating blood is important to me.
</td> <tr>
<td>si02</td> <td>
2. I am like the kind of person who donates blood.
</td> </tr>
<tr> <td>si03</td> 
<td>
3. Donating blood is an important part of who I am.
</td> </tr>
<tr> <td></td>
<td>
Intention
</td></tr>
<tr><td>it01</td>
<td>
1. I would like to donate blood in the future.
</td>   </tr>
<tr><td>it02</td>
<td>
2. I intend to donate blood in the future.
</td> </tr>
<tr><td>it03</td>
<td>
3. I intend to make more than just a one-off blood donation.
</td></tr>
<tr><td></td>
<td>
Intention to donate for emergency
</td></tr>
<tr><td>ie01</td>
<td>
1. I would be willing to donate blood if I received an urgent callout from the Finnish Red Cross Blood Service.
</td></tr>
<tr><td></td> 
<td>
Antecedents of psychological ownership
</td></tr>
<tr><td></td> 
<td>
Control
</td></tr>
<tr><td>ac01</td>
<td>
1. I have influence over the things that affect me while donating blood.
</td></tr>
<tr><td>ac02</td>
<td>
2. I control the location and scheduling for donating blood.
</td></tr>
<tr><td>ac03</td>
<td>
3. I influence decisions related to my blood donation.
</td></tr>
<tr><td>ac04</td>
<td>
4. In general, I have control over donating blood.
</td></tr>
<tr><td></td>
<td>
Intimate knowledge
</td></tr>
<tr><td>ai01</td>
<td>
1. I am intimately familiar with what is going on with regard to donating blood.
</td></tr>
<tr><td>ai02</td>
<td>
2. I have a depth of knowledge as it relates to donating blood.
</td></tr>
<tr><td>ai03</td>
<td>
3. I have a comprehensive understanding of donating blood.
</td></tr>
<tr><td>ai04</td>
<td>
4. I have a broad understanding of donating blood.
</td></tr>
<tr><td></td>
<td>
Blood donation history
</td></tr>
<tr><td>bd01</td>
<td>
1. Do you believe that you are currently eligible to donate blood [yes, no, unsure]
</td></tr>
<tr><td>bd02</td>
<td>
2. How many times in total have you donated blood at the Finnish Red Cross Blood Service Finland? [select number]
</td></tr>
<tr><td>bd03</td>
<td>
3. How many times in the last two years have you donated at the Finnish Red Cross Blood Service? [select number]
</td></tr>
<tr><td>bd04</td>
<td>
4. When did you last attend a Finnish Red Cross blood donation centre with the intention of donating blood? [select date]
</td></tr>
<tr><td></td>
<td>
Demographics
</td></tr>
<tr><td>de01</td>
<td>1. What is your gender? [man, woman, non-binary, prefer to not disclose, prefer to self-describe (open response)]
</td></tr>
<tr><td>de02</td>
<td>
2. How old are you today? [select number]
</td></tr>
</table>




```{r}
knitr::knit_exit()
```




## Simulate

All items are scored 1 (strongly disagree) to 7 (strongly agree).

```{r}
if (TRUE) { # if you have data you set this to false
  n <- 20
  source("../../responsesR/R/responses.R")

         
  
         
  data <- tibble(,rows=n)
  # you should be able to load the library instead of just sourcing it from cloned folder
  #hop this will be fixed soon
  age <- round(rnorm(n=n,mean=40,sd =10))
  #po <- genLikert(size =  n ,items = 3, levels=7, location=c(1,1,1),correlation = 0.5)
  #si <- genLikert(size =  n ,items = 3, levels=7, location=c(1,1,1),correlation = 0.5)
  #in <- genLikert(size =  n ,items = 3, levels=7, location=c(1,1,1),correlation = 0.5)

    data_likert_5<- genLikert(size =  n ,items = 3, levels=5, location=c(-1,-1),correlation = 0.5)
  data_likert_11<- genLikert(size =  n ,items = 1, levels=11, location=c(1))
  ferritin <- rlnorm(n= n ,meanlog = 3,sdlog = 1)
  data <- data %>% mutate(
    Kys1Age   = age ,    
    Kys2Gender       = case_when(
      data_likert_4$X == 1 ~ "Women",
      data_likert_4$X == 2 ~ "Men",
      data_likert_4$X == 3 ~ "Non-binary/other",
      data_likert_4$X == 4 ~ "Don't wish to respond"),
      
    Kys3DonationCount =  case_when(
      data_likert_11$X ==    1 ~ "None",
      data_likert_11$X ==  2 ~"1-10",
      data_likert_11$X ==3 ~ "11-20",
      data_likert_11$X ==4 ~ "21-30",
      data_likert_11$X ==5 ~ "31-40",
      data_likert_11$X ==6 ~ "51-60",
      data_likert_11$X ==7 ~ "61-70",
      data_likert_11$X ==8 ~ "71-80",
      data_likert_11$X ==9 ~ "81-90",
      data_likert_11$X ==10 ~ "91-100",
      data_likert_11$X == 11 ~ "Over 100"
      
    ),
    Kys4YearStarted   = 2024 - age - round(rnorm(n= n ,mean = 10, sd = 5 )),
    Kys5         =   data_likert_5$X1,
    Kys6         = data_likert_5$X2,
    Kys20aLabResults  = ferritin,
    Kys21  =   data_likert_5$X3,
  )
  
  summary(data)
}
```

## Process

```{r}

data <-  data %>% 
  mutate(
    Kys2Gender = factor(Kys2Gender),
    Kys3DonationCount = factor(Kys3DonationCount,ordered = TRUE),
    Kys5 = factor(
      Kys5,
      ordered = TRUE,
      levels = 1:5,
      labels =  c("Totally agree","Agree","Neutral","Disagree","Totally disagree")
    ),
    Kys6 = factor(
      Kys6,
      ordered = TRUE,
      levels = 1:5,
      labels = c("Totally agree","Agree","Neutral","Disagree","Totally disagree")
    ),
    Kys21 = factor(Kys5,ordered = TRUE)
  )
summary(data)
```



# Demographics

## Age by Gender

```{r}

p <- ggplot(data)
p <- p +  geom_histogram(aes(x=Kys1Age),binwidth = 5)
p <- p + facet_wrap(. ~ Kys2Gender)
p <- p + xlab("Age in years")
p

```


## Demographics Table 1

```{r}

table1 <-
  tbl_summary(
    data %>% rename(
      Age =  Kys1Age,
      YearStarted = Kys4YearStarted,
      DonationCount = Kys3DonationCount
    ),
    include = c(
      Age,
      YearStarted,  
      DonationCount
      ),
    by =  Kys2Gender
    
  ) %>%
  add_n()  # add column with total number of non-missing observations
table1
```




# Distributions of Likert scale questions


```{r , warning=FALSE}
items = data %>% 
    select(Kys5,Kys6) 

colnames(items) <- c("It was useful to receive genetic information","Receiving genetic information did not make me worry")

nlevels = 5
```


```{r , warning=FALSE}
q01 <- likert(
  items = as.data.frame(items),
  nlevels = nlevels
  
)
plot(q01, 
     type = "heat",
     legend.position = "bottom",
     text.size=3,
     include.histogram = FALSE)
```

add all the questions here


# Distributions of lab values

add here like age
